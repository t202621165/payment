package com.cypay.payment;

import com.alibaba.fastjson.JSONObject;
import com.cypay.common.enums.PaymentType;

import cn.hutool.crypto.SecureUtil;
import cn.hutool.crypto.symmetric.AES;

public class Authorize {
	
	private static String ssid = "author-1";
	
	private static String url = "jdbc:mysql://192.168.0.169:8889/payment_test?rewriteBatchedStatements=true";
	
	private static String username = "root";
	
	private static String password = "iwanol0928****";

	public static void main(String[] args) throws Exception {
		System.out.println("=======================系统授权===========================");
		authorize();
		System.out.println("======================数据源加密===========================");
        environmentEncrypt();
		System.out.println("======================可授权通道===========================");
		gallerys();
	}
	
	public static void authorize() {
		JSONObject json = new JSONObject();
		String aes_key = "c34a315844944c6da979a201dac0425e";
		String md5_key = "66ee9dd09f5647fbac9d4e9eb6081fa1";
		
		int[] g = new int[]{0,1,2,3,7}; // 授权通道的index
		json.put("G", g); // 授权通道-G：不限制通道个数、G0/G1：一个 、G2：两个...Gn：n个
//		json.put("G0", "1"); // 授权通道：1：全部通道
//		json.put("E", "1"); // 1：企业版；0：个人版
//		json.put("N", "5"); // 个人版最大允许注册商户数：默认 10
		json.put("A", "1"); // 支付宝代付
		json.put("W", "1"); // 微信代付
//		json.put("B", "012"); // 授权网关-0：通用 1：传奇 2：传世 3：传奇三 4：web 默认：全部
		json.put("D", "201001"); // 到期时间：yyMMdd
		String ip = "127.0.0.1"; // 授权的ip + 端口
		json.put("S", SecureUtil.md5(String.format("%s@@%s", json.toJSONString(), md5_key)));
		String data = json.toJSONString();
		System.out.println(data);
		String key = SecureUtil.md5(String.format("%s@%s", ip, aes_key));
		String token = SecureUtil.aes(key.getBytes()).encryptBase64(data);
		System.out.println("授权码标识：");
		System.out.println(SecureUtil.md5(String.format("%s@iwanol@%s", ssid, url.split("\\?")[0])));
		System.out.println("授权码：");
		System.out.println(token + "." + SecureUtil.aes(aes_key.getBytes()).encryptBase64(ip));
	}
	
	public static void gallerys() {
		int i = 0;
		for (PaymentType type : PaymentType.values()) {
			if (!type.getIsOpen()) {
				System.out.println(i++ + "	" + type.getName());
			}
		}
	}
	
	public static void environmentEncrypt() {
		AES aes = SecureUtil.aes("70c8163dbc3141df92dc8d650961a574".getBytes());
		System.out.println();
		
        System.out.printf("    url: %s\r\n    username: %s\r\n    password: %s", 
        		aes.encryptBase64(url), 
        		aes.encryptBase64(username), 
        		aes.encryptBase64(password));
        System.out.println();
	}
}
