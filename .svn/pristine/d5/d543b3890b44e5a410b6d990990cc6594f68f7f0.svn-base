(function(b,a){if(typeof jQuery!=="undefined"){a(b,jQuery)}})(typeof window!=="undefined"?window:this,function(a,b){b.recharge=function(){b(".products li").on("click",function(){b("[name=productId]").val(b(this).attr("data-product"));b(".productName").text(b(this).attr("data-title"));b(".rate").text(b(this).attr("data-rate"));b("#qrcode-type").attr("src","/assets/images/pay/"+b(this).attr("data-mark")+".png");check(true)});var d;var c=function(e){b.ajax({url:"/pay/query",data:{orderNumber:e},success:function(f){if(f==1){clearInterval(d);b.modalload("\u652f\u4ed8\u6210\u529f\uff0c\u8bf7\u7a0d\u7b49\u3002\u3002\u3002",2000);b("#qrcode").attr("src","/assets/images/pay/p_success.png");setTimeout(function(){document.location.href="/pay/success?orderNumber="+e},3000)}}})};b("#form-data").formvalidate(function(e,f){b.ajax({url:"/pay/recharge",data:e,success:function(g){f&&f();if(g.state){if(g.type){b("#orderAmount").text(g.amount+" \u5143");b(".pay-li.last").addClass("active");b("#pay-body2").css("display","none");b("#pay-body3").css("display","block");b("#qrcode").attr("src","/pay/qrcode?qrcodeUrl="+g.msg);b("#orderNumber").text(g.orderNumber);if(g.tip!=""){b("#tip").css("display","block");b("#tip").text("【为了防止支付风控，需要您多支付￥ "+g.tip+"元钱】")}d=setInterval(function(){c(g.orderNumber)},5000)}else{a.location.href=g.msg}}else{b.modalload(g.msg,1500);g.ele&&b("input[name="+g.ele+"]").focus()}}})})};b.message=function(){b("#form-data").formvalidate(function(c,d){b.ajax({url:"/pay/leaving",data:c,success:function(e){d&&d();if(e.state){b("#form-data").find("input, textarea").val("");b("#partition").find("option").first().attr("selected",true);b.modalload("\u7559\u8a00\u6210\u529f\uff0c\u7ba1\u7406"+"\u5458\u6536\u5230\u7559\u8a00\u540e\uff0c\u4f1a\u7b2c\u4e00"+"\u65f6\u95f4\u4e0e\u60a8\u8054\u7cfb\uff01",1800)}else{b.modalload(e.msg,1800)}}})})};b.query=function(){avalon.filters.dateNotNull=function(d,e){if(d){return avalon.filters.date(d,e)}return"--"};var c=avalon.define({$id:"order",data:null});b("#form-data").formvalidate(function(d,e){b.ajax({url:"/pay/oList",data:d,success:function(f){e&&e();if(f!=""){c.data=f}else{b.modalmsg("\u6682\u65e0\u8bb0\u5f55\uff01")}}})})}});