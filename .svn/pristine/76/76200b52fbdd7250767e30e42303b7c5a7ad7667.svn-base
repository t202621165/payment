package com.cypay.common.pattern.template.settlement.impl;

import java.util.Date;
import java.util.function.Consumer;

import org.springframework.stereotype.Component;
import org.springframework.util.StringUtils;

import com.cypay.common.entity.Bank;
import com.cypay.common.entity.SettleMent;
import com.cypay.common.enums.SettlementBusiness;
import com.cypay.common.pattern.template.settlement.SettlementTemplate;

/**
 * 拒绝付款
 * @author International
 * @2019年3月18日 下午5:55:12
 */
@Component
public class RefusePayment extends SettlementTemplate {

	@Override
	protected SettlementBusiness getSettlementBus() {
		return SettlementBusiness.REFUSE_PAYMENT;
	}
	
	@Override
	protected Consumer<? super SettleMent> getAction(String discription) {
		return s -> {
			s.setState(getSettlementBus().nextState());
			s.setComplateDate(new Date());
			if (!StringUtils.isEmpty(discription)) {
				s.setDiscription(discription);
			}
			Bank bank = s.getBank();
			// 拒绝审核-将提现金额和手续费退回账户余额中
			bank.setOverMoney(bank.getOverMoney().add(s.getAmount().add(s.getCost())));
			bank.setAllPay(bank.getAllPay().subtract(s.getAmount().add(s.getCost())));
		};
	}
}
