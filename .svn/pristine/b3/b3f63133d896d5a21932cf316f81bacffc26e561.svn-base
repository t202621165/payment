<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>payment.html</title>

<meta name="keywords" content="keyword1,keyword2,keyword3">
<meta name="description" content="this is my page">
<meta name="content-type" content="text/html; charset=UTF-8">
<link th:href="@{/assets/css/css.css}" rel="stylesheet" type="text/css">
<link th:href="@{/assets/css/main.css}" rel="stylesheet" type="text/css">
</head>
<style>
body {
	overflow-x: auto;
	background: #f2f0f5;
	padding: 15px 0px 10px 5px;
}

.Tabs {
	height: 26px;
	display: block;
}

.Tabs a {
	float: left;
	width: 90px;
	height: 30px;
	line-height: 30px;
	text-align: center;
	margin: 0px 2px;
	border-radius: 3px 3px 3px 3px;
	background: #909090
}

.Tabs a:hover {
	background: #A8A8A8;
}

.Tabs a.ActiveTab {
	border: 1px #666 solid;
	border-bottom: 1px #FFF solid;
}
</style>
<div th:replace="manage/common/common_js :: basic"></div>
<div th:replace="manage/common/common_js :: date"></div>
<body>
	<!--main_top-->
	<form id="form" :controller="settlement">
		<table th:width="99+'%'" th:border="0" th:cellspacing="0"
			th:cellpadding="0" id="searchmain">
			<tr>
				<td th:width="99+'%'" th:align="left" th:valign="top">æ‚¨çš„ä½ç½®ï¼š<span
					th:text="æç°ä¸šåŠ¡"></span>
				</td>
			</tr>
			<tr>
				<td th:align="left" th:valign="top">
						<div th:class="searchDiv">
							<div th:class="search-input">
								<div th:class="search-input-top">
									<span>å¼€å§‹æ—¶é—´ï¼š</span> <input type="text"
										th:value="${#dates.format(new java.util.Date().getTime(), 'yyyy-MM-dd 00:00:00')}" name="startDate"
										th:style="@{color: #528fc6;}"
										th:onclick="'javascript:WdatePicker({dateFmt:\'yyyy-MM-dd HH:mm:ss\',lang:\'zh-cn\'})'"
										th:placeholder="@{--å¹´--æœˆ--æ—¥  --:--:--}" th:readonly="readonly">
								</div>

							</div>
							<div th:class="search-input">
								<div th:class="search-input-top">
									<span>ç»“æŸæ—¶é—´ï¼š</span> <input type="text" 
										th:value="${#dates.format(new java.util.Date().getTime(), 'yyyy-MM-dd 23:59:59')}" name="endDate"
										th:style="@{color: #528fc6;}"
										th:onclick="'javascript:WdatePicker({dateFmt:\'yyyy-MM-dd HH:mm:ss\',lang:\'zh-cn\'})'"
										th:placeholder="@{--å¹´--æœˆ--æ—¥  --:--:--}" th:readonly="readonly">
								</div>
							</div>

							<div th:class="search-input">
								<div th:class="search-input-top">
									<span>å•†æˆ·ï¼©ï¼¤ï¼š</span> <input type="text" id="merchantId"
										th:name="merchantId" th:placeholder="è¯·è¾“å…¥å•†æˆ·ID">
								</div>

							</div>
							<div th:class="search-input">
								<div th:class="search-input-top">
									<span>ä½™é¢ï¼š</span> <input type="number" id="startMoney"
										name="useAmount" th:min="1" th:placeholder="0"> <span
										th:style="@{width: 20px;padding: 0;text-align: center;}">--</span>
									<input type="number"
										th:min="1" name = "amount" th:placeholder="@{99...9}">
								</div>
							</div>
							<div th:class="search-input">
								<div th:class="search-input-top">
									<span id="paging">æ¯é¡µæ•°é‡ï¼š</span>
									<div th:replace="manage/common/common_js :: pageSize"></div>
								</div>
							</div>
							
							<div th:class="search-input">
								<div>
									<input :click="@query" type="button"
										th:value="æŸ¥è¯¢" th:class="@{btn-check btn-default btn-query}">
								</div>
							</div>
						</div>
				</td>
			</tr>
			<tr>
				<td th:align="left" th:valign="top">

					<table th:width="100+'%'" th:border="0" th:cellspacing="0"
						th:cellpadding="0" id="main-tab">
						<thead id="tableTitle">
							<tr>
								<td th:colspan="11"
									th:style="@{text-align: left;padding: 10px;}" th:align="center"
									th:valign="middle" th:class="@{borderright borderbottom}">
									<div class="Tabs">
										<a href="javascript:void(0);" :click="@render.apply"
											style="text-decoration:none;color: white;font-size:14px;">ğŸˆ¸å¾…å®¡æ ¸</a>
										<a href="javascript:void(0);" :click="@render.payment"
											style="text-decoration:none;color: white;font-size:14px;">ğŸ’°å¾…ä»˜æ¬¾</a>
										<a href="javascript:void(0);" :click="@render.record"
											style="text-decoration:none;color: white;font-size:14px;">ğŸ“ç»“ç®—è®°å½•</a>
									</div>
									<input type="hidden" id="state" value="2" name="state">
								</td>
							</tr>
							<tr>
								<th th:align="center" th:valign="middle" th:class="borderright"><input
									type="checkbox" th:class="table-checkbox"
									:click="@checkAll($event)" /></th>
								<th th:align="center" th:valign="middle" th:class="borderright">ç”³è¯·æ—¶é—´</th>
								<th th:align="center" th:valign="middle" th:class="borderright">æµæ°´å·</th>
								<th th:align="center" th:valign="middle" th:class="borderright">æ”¶æ¬¾äºº</th>
								<th th:align="center" th:valign="middle" th:class="borderright">æ”¶æ¬¾é“¶è¡Œ</th>
								<th th:align="center" th:valign="middle" th:class="borderright">æ”¶æ¬¾è´¦å·</th>
								<th th:align="center" th:valign="middle" th:class="borderright">é‡‘é¢</th>
								<th th:align="center" th:valign="middle" th:class="borderright">æ‰‹ç»­è´¹</th>
								<th th:align="center" th:valign="middle" th:class="borderright">æè¿°</th>
								<th th:align="center" th:valign="middle" th:class="borderright">å®Œæˆæ—¶é—´</th>
								<th th:align="center" th:valign="middle" th:class="borderright">çŠ¶æ€</th>
							</tr>
						</thead>
						<tbody id="dataBody" :for="($index,item) in @data.content">
							<tr th:onMouseOut="@{this.style.backgroundColor='#ffffff'}"
								th:onMouseOver="@{this.style.backgroundColor='#edf5ff'}">
								<td th:align="center" th:valign="middle"
									th:class="@{borderright borderbottom}">
									<input type="checkbox" th:class="table-checkbox" />
								</td>
								<td th:align="center" th:valign="middle"
									th:class="@{borderright borderbottom}"
									:text="@item.applyDate | date('yyyy-MM-dd HH:mm:ss')">									
								</td>
								<td hidden="hidden">
									<input type="text" :duplex="@item.settlementId" id="settlementId">
									<input type="text" :duplex="@item.merchantId" id="merchantId">
								</td>
								<td th:align="center" th:valign="middle"
									th:class="@{borderright borderbottom}"
									:text="@item.serialNumber"></td>
								<td th:align="center" th:valign="middle"
									th:class="@{borderright borderbottom}" :text="@item.realName"></td>
								<td th:align="center" th:valign="middle"
									th:class="@{borderright borderbottom}":text="@item.bankName"></td>
								<td th:align="center" th:valign="middle"
									th:class="@{borderright borderbottom}"
									:text="@item.bankNumber"></td>
								<td th:align="center" th:valign="middle"
									th:class="@{borderright borderbottom}" :text="@item.amount | number(2)" id="amount" style="color:green;font-weight: bold;"></td>
								<td th:align="center" th:valign="middle"
									th:class="@{borderright borderbottom}" :text="@item.fee | number(2)" id="fee" style="color:red;font-weight: bold;"></td>
								<td th:align="center" th:valign="middle"
									th:class="@{borderright borderbottom}" :text="@item.discription" style="font-weight: bold;"></td>
								<td th:align="center" th:valign="middle"
									th:class="@{borderright borderbottom}" :text="@item.complateDate | dateNotNull('yyyy-MM-dd HH:mm:ss')"></td>
								<td th:align="center" th:valign="middle"
									th:class="@{borderright borderbottom}">
									<div th:class="@{tag primary}" :if="@item.state == 0">ç­‰å¾…å®¡æ ¸</div>
									<div th:class="@{tag success}" :if="@item.state == 1">å‡ºæ¬¾æˆåŠŸ</div>
									<div th:class="@{tag default}" :if="@item.state == 2">ç­‰å¾…å‡ºæ¬¾</div>
									<div th:class="@{tag red}" :if="@item.state == -2">èµ„é‡‘é©³å›</div>
									<div th:class="@{tag red}" :if="@item.state == -1">å®¡æ ¸å¤±è´¥</div>
								</td>
							</tr>
						</tbody>
						<tr onMouseOut="this.style.backgroundColor='#ffffff'" onMouseOver="this.style.backgroundColor='#edf5ff'" :if="@data.totalElements == 0">
							<td colspan="11" align="center" valign="middle" class="borderright borderbottom">æš‚æ— è®°å½•ï¼</td>
					   </tr> 
						<tfoot>
							<tr>
								<td th:colspan="11" th:style="@{text-align: left;padding: 10px;}" th:align="center" th:valign="middle" th:class="@{borderright borderbottom}">
									<input type="button" id="businessBtn" :click="@render.go(-1)" th:value="èµ„é‡‘å®¡æ‰¹" th:class="@{btn-check btn-blue}">
									<input shiro:hasPermission="payee_alipay" type="button" id="alipay" title="æ”¯ä»˜å®ä»£ä»˜" :click="@render.go(0)" value="ä»£ä»˜(æ”¯ä»˜å®)" class="btn-check btn-blue payee" th:style="@{margin-left:5px;}"> 
									<input shiro:hasPermission="payee_wechat" type="button" id="wechat" title="å¾®ä¿¡ä»£ä»˜" :click="@render.go(1)" value="ä»£ä»˜(å¾®ä¿¡)" class="btn-check btn-blue payee" th:style="@{margin-left:5px;}"> 
									<input type="button" :click="render.refuse" id="refuseBtn" th:value="é©³å›" th:class="@{btn-check btn-red}" th:style="@{margin-left:5px;}">
									<input type="button" hidden="hidden" :click="render.clear" id="clearBtn" th:value="æ¸…é™¤ç»“ç®—è®°å½•" th:class="@{btn-check btn-red}" th:style="@{width:110px;margin-left:5px;}">
								</td>
							</tr>
						</tfoot>
					</table>
				</td>
			</tr>
			<tr>
				<td th:align="left" th:valign="top" th:class="fenye"
					th:style="@{text-align: left;}">
					<div th:replace="manage/common/common_js :: fenye"></div>
				</td>
			</tr>
		</table>
	</form>
	<script>
		var options = {
			apply:function(){
				$("#businessBtn").show().val("ç”³è¯·é€šè¿‡");
				$("#refuseBtn").show().val("é©³å›ç”³è¯·");
				$("#state").val(0);
				$(".payee").hide();
				$("#clearBtn").hide();
				go();	
			},
			payment:function(){
				$("#businessBtn").show().val("èµ„é‡‘å®¡æ‰¹");
				$("#refuseBtn").show().val("é©³å›");
				$("#state").val(2);
				$(".payee").show();
				$("#clearBtn").hide();
				go();
			},
			record:function(){
				$("#businessBtn").hide();
				$("#refuseBtn").hide();
				$("#alipay").hide();
				$("#wechat").hide();
				$("#state").val(1);
				$("#clearBtn").show();
				go();
			},
			go:function(flag){
				var state = $("#state").val(); //0ç­‰å¾…å®¡æ ¸   2ç­‰å¾…å‡ºæ¬¾
				var data = new Array();
		Â  Â  Â  Â  var check = $("#dataBody input[type=checkbox]:checked");
				if (check.length > 0){
					check.each(function () {//éå†
			Â  Â  Â  Â  Â  Â  var row = $(this).parent("td").parent("tr");
			Â  Â  Â  Â  Â  Â  data.push(row.find("[id='settlementId']").val());
			Â  Â  Â  Â  });
					if(state == 0){
						window.parent.settlement(data,"/man/payment/AGREE_TO_AUDIT");
					}else if(state == 2){
						if (flag != -1){ //0ä¸ºæ”¯ä»˜å®ä»£ä»˜ 1ä¸ºå¾®ä¿¡ä»£ä»˜
							window.parent.layer.confirm('æ˜¯å¦ç¡®å®šä½¿ç”¨'+(flag==0?'æ”¯ä»˜å®':'å¾®ä¿¡')+'ä»£ä»˜ï¼Ÿ', {
			           			btn : [ 'ç¡®å®š', 'å–æ¶ˆ' ]
			       		 	}, function() {				       	
				       		 	window.parent.selectDaiFu(data,"/man/payee/",(flag==0?'alipay':'wechat'));
				       		});
						}else{
							window.parent.daifu(data,"/man/payment/AGREE_PAYMENT"); //å¹³å°æ”¯ä»˜
						}						
					}
				}else{
					window.parent.error("è¯·é€‰æ‹©æ“ä½œè®°å½•",2000);
				}
			},
			refuse : function() {
				var state = $("#state").val(); //0ç­‰å¾…å®¡æ ¸   2ç­‰å¾…å‡ºæ¬¾
				var index = window.parent.layer.prompt({
					title : 'è¾“å…¥æ‹’ç»ç†ç”±å¹¶ç¡®è®¤',
					formType : 2
				}, function(text, index) {
					var data = new Array();
			Â  Â  Â  Â  var check = $("#dataBody input[type=checkbox]:checked");
				    if (check.length > 0){
						window.parent.layer.close(index);
					    check.each(function () {//éå†
				Â  Â  Â  Â  Â  Â  var row = $(this).parent("td").parent("tr");
				Â  Â  Â  Â  Â  Â  data.push(row.find("[id='settlementId']").val());
			Â  Â  Â  Â 		 });
						if(state == 0){
							window.parent.settlement(data,"/man/payment/REFUSE_TO_AUDIT?disc=" + text);						
					 	}else if(state == 2){
							window.parent.settlement(data,"/man/payment/REFUSE_PAYMENT?disc=" + text);
						}
						return false;
				    }else{
				    	window.parent.error("è¯·é€‰æ‹©æ“ä½œè®°å½•",2000);
				    }
				});
			},
			clear:function(){
				var startDate = $('input[name="startDate"]').val();
			    var endDate = $('input[name="endDate"]').val();
			    window.parent.layer.confirm('æ˜¯å¦ç¡®è®¤æ¸…é™¤è¯¥æ—¶é—´æ®µçš„æ‰€æœ‰ç»“ç®—æ•°æ®ï¼Ÿ', {
	           		 btn : [ 'ç¡®å®š', 'å–æ¶ˆ' ]//æŒ‰é’®
	       		 	}, function() {
	       		 	window.parent.ajaxSend("get","/man/settlement/clear",{"startDate":startDate,"endDate":endDate},function(data){
	       		 		if(data.state){
	       		 			window.parent.success(data.msg,2000,function(){
	       		 				mainFrame.location.reload();
	       		 			});
	       		 		}else{
	       		 			window.parent.error(data.msg,2000);
	       		 		}
	       		 	});
	       		}); 
			}
		}
		var paging = $.paging("settlement",options,"#form");
		function go(){
			paging.query();
		}
	</script>
</body>
</html>
