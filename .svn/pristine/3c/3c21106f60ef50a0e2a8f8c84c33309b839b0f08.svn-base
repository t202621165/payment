package com.cypay.payment;

import java.util.Random;

import com.alibaba.fastjson.JSONObject;
import com.cypay.common.enums.PaymentType;
import com.cypay.common.service.impl.SystemSetService;

import cn.hutool.crypto.SecureUtil;
import cn.hutool.crypto.symmetric.AES;

public class Authorize {

	public static void main(String[] args) throws Exception {
		System.out.println("=======================系统授权===========================");
		authorize();
		System.out.println("======================数据源加密===========================");
        environmentEncrypt();
	}
	
	public static byte[] init() {  
        byte[] salt = new byte[8];  
        Random random = new Random();  
        random.nextBytes(salt);  
        return salt;  
    }
	
	public static void authorize() {
		JSONObject json = new JSONObject();
//		int[] g = new int[]{0,1,2,3,7}; // 授权通道的index
//		json.put("G0", g); // 授权通道-G：支持多通道 G0：不支持多通道 
		json.put("G0", "1"); // 授权通道：1：全部通道
		json.put("E", "0"); // 1：企业版；0：个人版
		json.put("N", "1");
		json.put("A", "1"); // 支付宝代付
		json.put("W", "1"); // 微信代付
		json.put("D", "201001"); // 到期时间：yyMMdd
		String ip = "127.0.0.1"; // 授权的ip + 端口
		json.put("S", SecureUtil.md5(String.format("%s@@%s", json.toJSONString(), SystemSetService.MD5_KEY)));
		String data = json.toJSONString();
		String key = SecureUtil.md5(String.format("%s@%s", ip, SystemSetService.AES_KEY));
		System.out.println("授权码：");
		System.out.println(SecureUtil.aes(key.getBytes()).encryptBase64(data) + "." + SecureUtil.aes(SystemSetService.AES_KEY.getBytes()).encryptBase64(ip));
		System.out.println("-------------------可授权通道----------------------------");
		int i = 0;
		for (PaymentType type : PaymentType.values()) {
			if (!type.getIsOpen()) {
				System.out.println(i++ + "	" + type.getName());
			}
		}
	}
	
	public static void environmentEncrypt() {
		AES aes = SecureUtil.aes("70c8163dbc3141df92dc8d650961a574".getBytes());
		System.out.println();
		
		String url = "jdbc:mysql://192.168.0.169:8889/payment?rewriteBatchedStatements=true";
		String username = "iwanol";
		String password = "iwanol0928****";
		
        System.out.printf("    url: %s\r\n    username: %s\r\n    password: %s", 
        		aes.encryptBase64(url), 
        		aes.encryptBase64(username), 
        		aes.encryptBase64(password));
        System.out.println();
	}
}
