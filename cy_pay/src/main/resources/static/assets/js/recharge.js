(function(c,d){if(typeof jQuery!=="undefined"){d(c,jQuery)}})(typeof window!=="undefined"?window:this,function(p,o){var c=$("input#payAmount"),f=[],n="";function k(b,r){var a=b.replace(/[^0-9]/ig,"");if(a>$.template_data.maxAmount){$.modalmsg("充值金额不能超过"+$.template_data.maxAmount+"元");c.focus();c.val(n);return}c.val(a);$("#bonus").css("display",a?"block":"none");if(a!=""&&n!=a){$.reward(Number(a),r)}n=a}o.recharge=function(){var a=0;o(".products li").on("click",function(){f.length=0;a=j(o(this));if(c.val()){n="";k(c.val(),a)}o("[name=productId]").val(o(this).attr("data-product"));o(".productName").text(o(this).attr("data-title"));o(".rate").text(o(this).attr("data-rate"));o("#qrcode-type").attr("class","qrcode-"+o(this).attr("data-mark"));check(true)});c.on("keyup blur",function(){k(this.value,a)});var b;var r=function(s){o.ajax({url:"/pay/query",data:{orderNumber:s},success:function(t){if(t==1){clearInterval(b);o.modalload("\u652f\u4ed8\u6210\u529f\uff0c\u8bf7\u7a0d\u7b49\u3002\u3002\u3002",2000);o("#qrcode").attr("src","/assets/images/pay/p_success.png");setTimeout(function(){document.location.href="/pay/successful/"+$("#uuid").val()+"?orderNumber="+s},3000)}}})};o("#form-data").formvalidate(function(t,s){$("#waiting").css("display","block");o.ajax({url:"/pay/recharge",data:t,success:function(u){$("#waiting").css("display","none");s&&s();if(u.state){if(u.type){o("#orderAmount").text(u.amount+" \u5143");o(".pay-li.last").addClass("active");o("#pay-body2").css("display","none");o("#pay-body3").css("display","block");var $qrcode;if(u.iframe){$qrcode=$('<iframe id="qrcode" class="img-png" src="'+u.msg+'"></iframe>')}else{if(u.createQrCode){$qrcode=$('<img src="'+("/pay/qrcode?qrcodeUrl="+u.msg)+'">')}else{$qrcode=$('<img src="'+(u.msg)+'">')}}$("#code-box").empty().append($qrcode);o("#orderNumber").text(u.orderNumber);if(u.tip!=""){o("#tip").text("【为了防止支付风控，需要您多支付￥ "+u.tip+"元钱】");o("#tip").css("display","block")}b=setInterval(function(){r(u.orderNumber)},5000)}else{p.location.href=u.msg}}else{o.modalload(u.msg,1500);u.ele&&o("input[name="+u.ele+"]").focus()}}})})};o.message=function(){o("#form-data").formvalidate(function(b,a){o.ajax({url:"/pay/leaving",data:b,success:function(r){a&&a();if(r.state){o("#form-data").find("input, textarea").val("");o("#partition").find("option").first().attr("selected",true);o.modalload("\u7559\u8a00\u6210\u529f\uff0c\u7ba1\u7406"+"\u5458\u6536\u5230\u7559\u8a00\u540e\uff0c\u4f1a\u7b2c\u4e00"+"\u65f6\u95f4\u4e0e\u60a8\u8054\u7cfb\uff01",1800);if (r.ele) $("#wx_qrcode").attr("src","/pay/qrcode2?qrcodeUrl=" + r.ele);o("#form-data").addClass("hide");$("#leave-succ").removeClass("hide")}else{o.modalload(r.msg,1800)}}})})};o.query=function(){avalon.filters.dateNotNull=function(r,b){if(r){return avalon.filters.date(r,b)}return"--"};var a=avalon.define({$id:"order",data:null});o("#form-data").formvalidate(function(r,b){o.ajax({url:"/pay/oList",data:r,success:function(s){b&&b();if(s!=""){a.data=s}else{o.modalmsg("\u6682\u65e0\u8bb0\u5f55\uff01")}}})})};$.reward=function(r,s){if($.template_data&&typeof $.template_data==="object"){if($.template_data.giveWay){s=i(r)}$("#giveAmount,#bonus-content").empty();var t=l(r);var a=g(r,s,t);var b=r+t+a;t>0&&$("#giveAmount").text("激励赠送："+t+" 元");$("#proGiveAmount").text(a);$("#bonus-content").append("<h4>"+$.template_data.currencyName+"："+$.template_data.ratio*b+"</h4>");h(r,t,a);m(r,t,a);e(r,t,a)}};function i(b){if(f.length>0){var r=f[0];if(b<r.amount){return r.rate}if(f.length>1){for(var a=f.length-1;a>0;a--){var s=f[a];if(b>=s.amount){return s.rate}}}}return 0}function j(u){if($.template_data&&$.template_data.giveWay){var b=u.find(".amountRate");for(var r=0,a=b.length;r<a;r++){var s=$(b[r]),t={};t.amount=s.find("#amount").text();t.rate=s.find("#rate").text();f.push(t)}}else{return u.attr("data-rate")}return 0}function h(b,r,a){var s=$.template_data.additionals;if(s&&$.template_data.showAdditional){d(s,b,r,a)}}function m(b,s,a){var r=$.template_data.integrals;if(r&&$.template_data.showIntegral){d(r,b,s,a)}}function e(r,b,x){var s=$.template_data.equips,u="";if(s&&$.template_data.showEquip){var v=q($.template_data.equipType,r,b,x);for(var a=0,t=s.length;a<t;a++){var w=s[a];if(w.type!=0&&v>=w.amount){u+=a==0?"":"、";u+=w.name+" x 1"}}if(u!=""){$("#bonus-content").append("<h4>赠送装备："+u+"</h4>")}}}function d(v,t,w,b){for(var s=0,a=v.length;s<a;s++){var u=v[s];if(u.type!=0&&u.ratio>0){var r=q(u.type,t,w,b);$("#bonus-content").append("<h4>"+u.name+"："+(r*u.ratio)+"</h4>")}}}function q(s,r,t,a){var b=0;switch(s){case 1:b=r;break;case 2:b=r+a;break;case 3:b=r+t;break;case 4:b=r+t+a;break}return b}function l(u){var s=$.template_data.incentives,b=0,r=0;if(s){for(var t=0,a=s.length;t<a;t++){var v=s[t];if(v.amount<=u&&r<=v.amount){r=v.amount;b=v.giveAmount}}}return Number(b)}function g(a,b,r){a+=$.template_data.isContains?r:0;return parseInt(a*b*0.01)}});